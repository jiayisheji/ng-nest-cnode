# Schematics 实战1

> 本篇使用 [Nx console](https://github.com/nrwl/nx-console) 插件完成。如果使用 `Schematics Cli` 或者 `Angular-cli` 可以参考我另外一篇[文章](https://github.com/jiayisheji/blog/issues/28)。

万丈高楼平地起，我们先写几个简单的例子练练手：

1. 动态创建一个`*.md`文件填入内容，并对它进行修改
2. 根据配置创建一个自定义模板文件
3. 根据配置创建一个自定义模板文件，修改原有的文件做关联
4. 迁移指定原有文件代码

> 我们需要一些工具函数 因为我们这是 `Angular` 扩展项目， 可以直接搬运 [https://github.com/angular/angular-cli/blob/master/packages/schematics/angular/utility](https://github.com/angular/angular-cli/blob/master/packages/schematics/angular/utility)。如果不是 `Angular` 也可以参考这些工具函数。

## 生成 md 文件

因为这是 `*.ts`，`schematics` 不能直接运行, 所以需要编译成 `*.js`

```bash
npx tsc -p ./schematics/tsconfig.json
```

在开一个命令行

```bash
npx schematics ./schematics/src/collection.json:hello-world
```

就会出现：

```text
? md文件使用什么名称? hello
CREATE hello.md (4 bytes)
```

> **注意**：现在只是一个虚拟的文件路径，并没有创建这个路径。默认创建是在项目根目录。默认：`--dry-run=true`，只会显示在命令行里

生成实际的文件：

```bash
npx schematics ./schematics/src/collection.json:hello-world --dry-run=false
```

我们已经生成文件，现在内容是写死的，再来一个输入属性，填充内容

```text
? md文件使用什么名称? world
? 请输入内容? hello
CREATE world.md (4 bytes)
```

你会发现我每次创建的名字都不一样，确实要这样，不然就会报错：`Error: Path "/hello.md" already exist.`。

那我们来实现修改功能

```text
? md文件使用什么名称? hello
? 请输入内容? 123456
UPDATE hello.md (18 bytes)
```

我们来实现删除文件，如果不输入内容就删除文件

```text
? md文件使用什么名称? hello
? 请输入内容?
DELETE hello.md
```

我们已经实现一个md文件的新增、修改、删除功能。